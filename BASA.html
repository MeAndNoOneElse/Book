<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Две комнаты с окнами и перетаскиванием предметов</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <!-- Компонент для перетаскивания объектов мышью -->
    <script src="https://cdn.jsdelivr.net/npm/aframe-mouse-manipulation@latest/dist/aframe-mouse-manipulation.min.js"></script>

    <!-- Компонент для телепортации между комнатами -->
    <script>
        AFRAME.registerComponent('room-teleporter', {
            schema: {
                targetPosition: {type: 'vec3', default: {x: 0, y: 1.6, z: 0}},
                targetRotation: {type: 'vec3', default: {x: 0, y: 0, z: 0}}
            },

            init: function () {
                var data = this.data;
                var el = this.el;

                el.addEventListener('click', function () {
                    var cameraRig = document.querySelector('#cameraRig');
                    cameraRig.setAttribute('position', data.targetPosition);
                    cameraRig.setAttribute('rotation', data.targetRotation);
                });

                el.addEventListener('mouseenter', function () {
                    el.setAttribute('material', 'emissive', '#00FF00');
                    el.setAttribute('material', 'emissiveIntensity', '0.3');
                });

                el.addEventListener('mouseleave', function () {
                    el.setAttribute('material', 'emissive', '#000000');
                    el.setAttribute('material', 'emissiveIntensity', '0');
                });
            }
        });
    </script>

    <style>body {margin: 0;}</style>
</head>

<body>
<a-scene>

    <!-- Система управления активами -->
    <a-assets>
        <!-- Текстура гор для окон и улицы -->
        <img id="mountainTexture" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg">
        <img id="wallTexture" src="https://cdn.aframe.io/a-painter/images/floor.jpg">
        <img id="woodTexture" src="https://cdn.glitch.global/341720a5-9f15-4d6e-a6c1-8e90d3a5c4bc/wood.jpg">
    </a-assets>

    <!-- Курсор для взаимодействия с объектами -->
    <a-entity
            cursor="rayOrigin: mouse"
            raycaster="objects: .clickable, .draggable"
            mouse-manipulation>
    </a-entity>

    <!-- ========== КОМНАТА 1 (Стартовая) ========== -->
    <!-- Пол комнаты 1 -->
    <a-box
            position="0 0 0"
            width="10" height="0.2" depth="10"
            color="#8B7355"
            material="roughness: 0.8">
    </a-box>

    <!-- Потолок комнаты 1 -->
    <a-box
            position="0 5 0"
            width="10" height="0.2" depth="10"
            color="#CCCCCC">
    </a-box>

    <!-- Стены комнаты 1 -->
    <!-- Задняя стена с окном -->
    <a-box position="-2.5 2.5 -5" width="5" height="5" depth="0.2" color="#87CEEB"></a-box>
    <a-box position="2.5 2.5 -5" width="5" height="5" depth="0.2" color="#87CEEB"></a-box>
    <a-box position="0 4.25 -5" width="10" height="1.5" depth="0.2" color="#87CEEB"></a-box>
    <a-box position="0 0.75 -5" width="10" height="1.5" depth="0.2" color="#87CEEB"></a-box>

    <!-- ОКНО 1 - вид на горы -->
    <a-plane
            position="0 2.5 -4.95"
            width="3" height="2.5"
            src="#mountainTexture"
            material="side: double; opacity: 0.9">
    </a-plane>

    <!-- Рама окна -->
    <a-box position="0 2.5 -4.9" width="3.1" height="2.6" depth="0.05" color="#654321" material="opacity: 0.3; transparent: true"></a-box>

    <!-- Левая стена -->
    <a-box position="-5 2.5 0" width="0.2" height="5" depth="10" color="#87CEEB"></a-box>

    <!-- Правая стена с окном -->
    <a-box position="5 2.5 -2.5" width="0.2" height="5" depth="5" color="#87CEEB"></a-box>
    <a-box position="5 2.5 2.5" width="0.2" height="5" depth="5" color="#87CEEB"></a-box>
    <a-box position="5 4.25 0" width="0.2" height="1.5" depth="10" color="#87CEEB"></a-box>
    <a-box position="5 0.75 0" width="0.2" height="1.5" depth="10" color="#87CEEB"></a-box>

    <!-- ОКНО 2 - вид на горы -->
    <a-plane
            position="4.95 2.5 0"
            rotation="0 -90 0"
            width="3" height="2.5"
            src="#mountainTexture"
            material="side: double; opacity: 0.9">
    </a-plane>

    <!-- Рама окна 2 -->
    <a-box position="4.9 2.5 0" rotation="0 90 0" width="3.1" height="2.6" depth="0.05" color="#654321" material="opacity: 0.3; transparent: true"></a-box>

    <!-- Передняя стена с дверью -->
    <a-box position="-2.5 2.5 5" width="5" height="5" depth="0.2" color="#87CEEB"></a-box>
    <a-box position="2.5 2.5 5" width="5" height="5" depth="0.2" color="#87CEEB"></a-box>

    <!-- ДВЕРЬ в комнату 2 -->
    <a-box
            id="door1"
            position="0 2 5"
            width="2" height="3" depth="0.3"
            color="#FFD700"
            room-teleporter="targetPosition: 0 1.6 30; targetRotation: 0 180 0"
            class="clickable">
        <a-text value="→ КОМНАТА 2" align="center" color="#000" position="0 0.5 0.16" scale="1.5 1.5 1.5"></a-text>
    </a-box>

    <!-- Перетаскиваемые объекты в комнате 1 -->
    <a-box
            position="-2 0.6 -2"
            width="1" height="1" depth="1"
            color="#FF5733"
            class="draggable">
        <a-text value="Двигай меня!" align="center" color="#FFF" position="0 0.7 0" scale="0.8 0.8 0.8"></a-text>
    </a-box>

    <a-sphere
            position="2 1 -2"
            radius="0.7"
            color="#33C1FF"
            class="draggable">
    </a-sphere>

    <a-cylinder
            position="0 0.8 -3"
            radius="0.4"
            height="1.5"
            color="#FF69B4"
            class="draggable">
    </a-cylinder>

    <!-- ========== КОМНАТА 2 ========== -->
    <!-- Пол комнаты 2 -->
    <a-box position="0 0 30" width="10" height="0.2" depth="10" color="#556B2F" material="roughness: 0.8"></a-box>

    <!-- Потолок комнаты 2 -->
    <a-box position="0 5 30" width="10" height="0.2" depth="10" color="#AAAAAA"></a-box>

    <!-- Стены комнаты 2 -->
    <!-- Задняя стена с окном -->
    <a-box position="-2.5 2.5 25" width="5" height="5" depth="0.2" color="#FFB6C1"></a-box>
    <a-box position="2.5 2.5 25" width="5" height="5" depth="0.2" color="#FFB6C1"></a-box>
    <a-box position="0 4.25 25" width="10" height="1.5" depth="0.2" color="#FFB6C1"></a-box>
    <a-box position="0 0.75 25" width="10" height="1.5" depth="0.2" color="#FFB6C1"></a-box>

    <!-- ОКНО 3 - вид на горы -->
    <a-plane
            position="0 2.5 25.05"
            rotation="0 180 0"
            width="3" height="2.5"
            src="#mountainTexture"
            material="side: double; opacity: 0.9">
    </a-plane>

    <!-- Рама окна 3 -->
    <a-box position="0 2.5 25.1" width="3.1" height="2.6" depth="0.05" color="#654321" material="opacity: 0.3; transparent: true"></a-box>

    <!-- Левая стена -->
    <a-box position="-5 2.5 30" width="0.2" height="5" depth="10" color="#FFB6C1"></a-box>

    <!-- Правая стена -->
    <a-box position="5 2.5 30" width="0.2" height="5" depth="10" color="#FFB6C1"></a-box>

    <!-- Передняя стена с дверью обратно и ВЫХОДОМ НА УЛИЦУ -->
    <a-box position="-3.5 2.5 35" width="3" height="5" depth="0.2" color="#FFB6C1"></a-box>
    <a-box position="3.5 2.5 35" width="3" height="5" depth="0.2" color="#FFB6C1"></a-box>

    <!-- ДВЕРЬ обратно в комнату 1 -->
    <a-box
            id="door2"
            position="-1.5 2 35"
            width="1.5" height="3" depth="0.3"
            color="#9370DB"
            room-teleporter="targetPosition: 0 1.6 0; targetRotation: 0 0 0"
            class="clickable">
        <a-text value="← КОМ.1" align="center" color="#FFF" position="0 0.5 -0.16" scale="1.2 1.2 1.2"></a-text>
    </a-box>

    <!-- ВЫХОД НА УЛИЦУ -->
    <a-box
            id="doorOutside"
            position="1.5 2 35"
            width="1.5" height="3" depth="0.3"
            color="#228B22"
            room-teleporter="targetPosition: 0 1.6 50; targetRotation: 0 180 0"
            class="clickable">
        <a-text value="↑ УЛИЦА" align="center" color="#FFF" position="0 0.5 -0.16" scale="1.2 1.2 1.2"></a-text>
    </a-box>

    <!-- Перетаскиваемые объекты в комнате 2 -->
    <a-cylinder
            position="-2 1 28"
            radius="0.5" height="2"
            color="#FFD700"
            class="draggable">
    </a-cylinder>

    <a-cone
            position="2 1.5 27"
            radius-bottom="0.8" height="2"
            color="#FF1493"
            class="draggable">
    </a-cone>

    <a-torus
            position="0 1.2 27"
            radius="0.6"
            radius-tubular="0.15"
            color="#00CED1"
            class="draggable">
    </a-torus>

    <!-- ========== УЛИЦА ========== -->
    <!-- Земля на улице -->
    <a-plane
            position="0 0 55"
            rotation="-90 0 0"
            width="30" height="30"
            color="#8FBC8F"
            material="roughness: 1">
    </a-plane>

    <!-- Небо с горами (360° панорама) -->
    <a-sky
            src="#mountainTexture"
            rotation="0 -90 0">
    </a-sky>

    <!-- Дверь обратно в комнату 2 с улицы -->
    <a-box
            id="doorInside"
            position="0 2 35.3"
            width="1.5" height="3" depth="0.3"
            color="#8B4513"
            room-teleporter="targetPosition: 0 1.6 30; targetRotation: 0 180 0"
            class="clickable">
        <a-text value="← НАЗАД" align="center" color="#FFF" position="0 0.5 0.16" scale="1.2 1.2 1.2"></a-text>
    </a-box>

    <!-- Декоративные объекты на улице (можно двигать) -->
    <a-box
            position="3 0.5 52"
            width="1" height="1" depth="1"
            color="#8B4513"
            class="draggable">
    </a-box>

    <a-sphere
            position="-3 1 52"
            radius="1"
            color="#32CD32"
            class="draggable">
    </a-sphere>

    <!-- ========== КАМЕРА И УПРАВЛЕНИЕ ========== -->
    <a-entity id="cameraRig" position="0 1.6 0">
        <a-camera
                id="camera"
                position="0 0 0"
                wasd-controls="acceleration: 25"
                look-controls="pointerLockEnabled: false">

            <!-- Курсор для клика -->
            <a-cursor
                    color="#FFFFFF"
                    raycaster="objects: .clickable, .draggable">
            </a-cursor>
        </a-camera>
    </a-entity>

    <!-- ========== ОСВЕЩЕНИЕ ========== -->
    <a-light type="ambient" intensity="0.6" color="#FFF"></a-light>
    <a-light type="point" intensity="0.8" position="0 4 0"></a-light>
    <a-light type="point" intensity="0.8" position="0 4 30"></a-light>
    <a-light type="point" intensity="0.7" position="0 4 55"></a-light>

</a-scene>
</body>
</html>
